"use strict";

;

(function ($, _, d) {
  'use strict';

  var adminPanelSettings = {
    onInit: function onInit() {
      this.getSelectorName();
      this.bindEvents();
      this.payments();
    },
    getSelectorName: function getSelectorName() {
      this._elements = {
        $baseWrap: $('.portuna-addon-admin'),
        $linkWrap: $('#toplevel_page_portuna-addon'),
        $formSave: $('#portuna-addon-form'),
        $saveBtn: $('.portuna-addon-form-save-btn'),
        $hash: window.location.hash
      };
    },
    bindEvents: function bindEvents() {
      var _this$_elements = this._elements,
          $baseWrap = _this$_elements.$baseWrap,
          $linkWrap = _this$_elements.$linkWrap,
          $formSave = _this$_elements.$formSave,
          $saveBtn = _this$_elements.$saveBtn,
          $hash = _this$_elements.$hash;
      var $hashRgx = $hash.split('/'),
          $wpSubMenu = $linkWrap.find('.wp-submenu'),
          $getUrl = 'admin.php?page=portuna-addon' + $hashRgx[0],
          $tabSelect;
      $formSave.on('submit', function (e) {
        e.preventDefault();
        $.post({
          url: _.ajaxUrl,
          data: {
            nonce: _.nonce,
            action: _.action,
            data: $formSave.serialize()
          },
          beforeSend: function beforeSend() {
            $saveBtn.text('...');
          },
          success: function success($) {
            console.log($);

            if ($.success) {
              $saveBtn.attr('disabled', !0);
              $saveBtn.text(_.savedChangesText);
            }
          }
        });
      }), $formSave.on('keyup change paste', 'input, select, textarea, :checkbox, :radio', function () {
        $saveBtn.attr('disabled', !1).text(_.saveChangesText);
      });

      if ($hashRgx[$hashRgx.length - 1] == 0) {
        var $hashRgxLink = $hashRgx[$hashRgx.length - 2],
            $matches = $hashRgxLink.match(/[a-zA-Z]+/g);
        $tabSelect = $matches[0];
      } else {
        var _$hashRgxLink = $hashRgx[$hashRgx.length - 1],
            _$matches = _$hashRgxLink.match(/[a-zA-Z]+/g);

        $tabSelect = _$matches[0];
      }

      $baseWrap.find('.portuna-addon-admin--content-menu--' + $tabSelect).addClass('nav-is-active').siblings().removeClass('nav-is-active');
      $hash && $('#toplevel_page_portuna-addon .wp-submenu li a[href="' + $getUrl + '"]').parent('li').addClass('current').siblings().removeClass('current');
      $wpSubMenu.on('click', 'a', function (e) {
        if (!e.currentTarget.hash) return !0;
        e.preventDefault();
        window.location.hash = e.currentTarget.hash;
        var wp_get_hash = window.location.hash.match(/[a-zA-Z]+/g);
        $baseWrap.find('.portuna-addon-admin--content-menu--' + wp_get_hash[0]).addClass('nav-is-active').siblings().removeClass('nav-is-active');
        $(this).parent().addClass('current').siblings().removeClass('current');
      });
    },
    payments: function payments() {
      if (!window.$ipsp) return;
      var $baseWrap = this._elements.$baseWrap; 

      var purchasedLink = $baseWrap.find('.portuna-addon-admin--panel-redirect');
      var button = $ipsp.get('button');
      button.setMerchantId(1474027);
      button.setAmount('10', 'USD', true);
      button.setHost('pay.fondy.eu');
      console.log(window);
      $ipsp('button').addField({
        'label': 'Account Id',
        'name': 'account_id',
        'value': '127318273',
        'readonly': true,
        'required': true 

      });
      purchasedLink.attr('href', button.getUrl());
    }
  };
  $(function () {
    adminPanelSettings.onInit();
  });
})(jQuery, window.portunaAjax, document);
